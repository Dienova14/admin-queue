<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Charger Motor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --primary: #2563eb;
  --success: #16a34a;
  --warning: #f59e0b;
  --muted: #64748b;
  --bg: #f1f5f9;
  --border: #e2e8f0;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Inter", "Segoe UI", sans-serif;
  background: var(--bg);
  min-height: 100vh;
  padding: 16px;
}

.container {
  max-width: 1100px;
  margin: auto;
}

/* HEADER */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.header h1 {
  font-size: 22px;
  margin: 0;
}

.header p {
  margin: 4px 0 0;
  color: var(--muted);
  font-size: 14px;
}

/* BUTTON */
button {
  padding: 14px 22px;
  border-radius: 14px;
  border: none;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: .2s;
}

button:active { transform: scale(.97); }

.btn-next {
  background: linear-gradient(135deg, #16a34a, #15803d);
  color: white;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: 16px;
}

/* CARD */
.card {
  background: white;
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 15px 35px rgba(0,0,0,.08);
}

/* CURRENT */
.current h2 {
  margin-top: 0;
  font-size: 18px;
}
.current .number {
  font-size: 42px;
  font-weight: 800;
  color: var(--success);
}
.current .info {
  margin-top: 10px;
  font-size: 15px;
}

/* LIST */
.list h2 {
  margin-top: 0;
  font-size: 18px;
}

.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px;
  border-radius: 14px;
  background: #f8fafc;
  margin-bottom: 10px;
}

.item b {
  font-size: 15px;
}

.badge {
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
}

.badge.wait { background: #e5e7eb; color: var(--muted); }
.badge.ready { background: #fef3c7; color: var(--warning); }
.badge.now { background: #dcfce7; color: var(--success); }

.empty {
  text-align: center;
  color: var(--muted);
  padding: 20px;
  font-size: 14px;
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <div>
      <h1>ðŸ”Œ Admin Charger Motor</h1>
      <p>Kelola antrian & status charging</p>
    </div>
    <button class="btn-next" onclick="nextQueue()">NEXT</button>
  </div>

  <div class="grid">

    <!-- CURRENT -->
    <div class="card current">
      <h2>Sedang Charging</h2>
      <div class="number" id="currentNumber">-</div>
      <div class="info" id="currentInfo">Belum ada</div>
    </div>

    <!-- LIST -->
    <div class="card list">
      <h2>Antrian</h2>
      <div id="queueList" class="empty">Memuat data...</div>
    </div>

  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCIdveFrv0s1sD4N1sID8x0DH2RKgo5LJg",
  authDomain: "queue-charge.firebaseapp.com",
  projectId: "queue-charge"
});
const db = firebase.firestore();

let currentNumber = 0;

/* ================= REALTIME META ================= */
db.collection("meta").doc("state").onSnapshot(doc => {
  currentNumber = doc.exists ? doc.data().current : 0;
  render();
});

/* ================= REALTIME QUEUE ================= */
db.collection("queue")
  .orderBy("number")
  .onSnapshot(snapshot => {
    window.queueData = snapshot.docs.map(d => d.data());
    render();
  });

/* ================= RENDER ================= */
function render() {
  renderCurrent();
  renderList();
}

function renderCurrent() {
  const current = window.queueData?.find(q => q.number === currentNumber);

  if (!current) {
    currentNumberEl.innerText = "-";
    currentInfo.innerText = "Belum ada";
    return;
  }

  currentNumberEl.innerText = "#" + current.number;
  currentInfo.innerHTML = `
    <b>${current.name}</b><br>
    ${current.plate}
  `;
}

function renderList() {
  const list = document.getElementById("queueList");
  if (!window.queueData || window.queueData.length === 0) {
    list.innerHTML = '<div class="empty">Belum ada antrian</div>';
    return;
  }

  list.innerHTML = "";

  window.queueData.forEach(q => {
    let status = "MENUNGGU", cls = "wait";

    if (q.number === currentNumber) {
      status = "SEKARANG";
      cls = "now";
    } else if (q.number === currentNumber + 1) {
      status = "BERSIAP";
      cls = "ready";
    }

    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div>
        <b>#${q.number}</b><br>
        ${q.name} â€“ ${q.plate}
      </div>
      <span class="badge ${cls}">${status}</span>
    `;
    list.appendChild(div);
  });
}

/* ================= NEXT ================= */
async function nextQueue() {
  const ref = db.collection("meta").doc("state");
  const snap = await ref.get();
  const current = snap.exists ? snap.data().current : 0;
  await ref.set({ current: current + 1 });
}
</script>

</body>
</html>
