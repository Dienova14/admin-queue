<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Charger Motor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --success:#16a34a;
  --warning:#f59e0b;
  --muted:#64748b;
  --danger:#ef4444;
  --bg:#f1f5f9;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Segoe UI,sans-serif;
  background:var(--bg);
  padding:16px;
}
.container{max-width:1100px;margin:auto}
h1{margin:0}
button{
  padding:10px 16px;
  border-radius:12px;
  border:none;
  font-weight:600;
  cursor:pointer;
}
.next{background:var(--success);color:white}
.skip{background:var(--warning);color:white}
.reset{background:var(--danger);color:white}

.item{
  background:white;
  padding:14px;
  border-radius:14px;
  margin-bottom:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.badge{
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
}
.now{background:#dcfce7;color:var(--success)}
.ready{background:#fef3c7;color:var(--warning)}
.wait{background:#e5e7eb;color:var(--muted)}
.done{background:#e5e7eb;color:#475569}
</style>
</head>

<body>

<div class="container">
  <h1>ðŸ”Œ Admin Charger Motor</h1>
  <br>
  <button class="next" onclick="next()">NEXT</button>
  <button class="skip" onclick="next()">SKIP</button>
  <button class="reset" onclick="resetAll()">RESET</button>
  <br><br>
  <div id="list"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCIdveFrv0s1sD4N1sID8x0DH2RKgo5LJg",
  authDomain:"queue-charge.firebaseapp.com",
  projectId:"queue-charge"
});
const db=firebase.firestore();

let current=0, queue=[];

db.collection("meta").doc("state").onSnapshot(d=>{
  current=d.exists?d.data().current:0;
  render();
});

db.collection("queue").onSnapshot(s=>{
  queue=s.docs.map(d=>d.data()).sort((a,b)=>a.number-b.number);
  render();
});

function render(){
  list.innerHTML="";
  queue.forEach(q=>{
    let st="MENUNGGU", cls="wait";
    if(q.number < current){st="SELESAI";cls="done";}
    else if(q.number===current){st="SEKARANG";cls="now";}
    else if(q.number===current+1){st="BERSIAP";cls="ready";}

    list.innerHTML+=`
      <div class="item">
        <div><b>#${q.number}</b> ${q.name} â€“ ${q.plate}</div>
        <span class="badge ${cls}">${st}</span>
      </div>`;
  });
}

async function next(){
  await db.collection("meta").doc("state").set({current:current+1});
}
async function resetAll(){
  if(!confirm("Reset semua antrian?"))return;
  const snap=await db.collection("queue").get();
  const b=db.batch();
  snap.docs.forEach(d=>b.delete(d.ref));
  await b.commit();
  await db.collection("meta").doc("state").set({current:0});
}
</script>

</body>
</html>
